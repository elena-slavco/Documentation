<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>5. Validate: Graph Comparison - Triply Documentation</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.4.3, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="../../../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../../../css/style.min.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">
<div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> <!-- end of book-search-input -->

<nav role="navigation">
<ul class="summary">
<li>
<a href="../../.." target="_blank" class="custom-link">Triply Documentation</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="">
<a href="../../..">Home</a>
<li class="header">TriplyDB</li>

<li>
<a href="../../../triply-db-getting-started" class="">Getting started</a>
</li>

<li class="header">TriplyETL</li>

<li>
<a href="#">General</a>
<ul>

<li>
<a href="../.." class="">Overview</a>
</li>

<li>
<a href="../../getting-started" class="">Getting started</a>
</li>

<li>
<a href="../../cli" class="">Command Line Interface (CLI)</a>
</li>

<li>
<a href="../../changelog" class="">Changelog</a>
</li>

<li>
<a href="../../maintenance" class="">Maintenance</a>
</li>
</ul>
</li>

<li>
<a href="#">TriplyETL Approach</a>
<ul>

<li>
<a href="../../extract" class="">Extract</a>
</li>
</ul>
</li>

<li class="header">Yasgui</li>

<li>
<a href="../../../yasgui" class="">Introduction</a>
</li>

<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<p>Graph comparison is an approach for validating that the data produced by your TriplyETL pipeline is correct.</p>
<p>For a limited set of key records, the linked data that is generated by the TriplyETL pipeline is compared to graphs that were created by hand.  This comparison must follow certain rules that are laid out in the RDF standards.</p>
<h1 id="prerequisites">Prerequisites</h1>
<p>Graph comparison can be used when the following preconditions are met:</p>
<ol>
<li>You have identified a number of key records that are representative of your dataset.</li>
<li>For these identified key records, you have created RDF files that contain the linked data that should be generated by your TriplyETL pipeline.</li>
<li>You have added these RDF files to your TriplyETL configuration, e.g. by storing them in a special subdirectory next to your <code>*.ts</code> files.</li>
</ol>
<p>The function for comparing graphs can be imported from the generic TriplyETL library:</p>
<pre><code class="language-ts">import { compareGraphs } from '@triplyetl/etl/generic'
</code></pre>
<h1 id="a-complete-example">A complete example</h1>
<p>We use the following full TriplyETL script to explain the validation feature.  Do not be afraid by the length of the script; we will go through each part step-by-step.</p>
<pre><code class="language-ts">import { compareGraphs, declarePrefix, Etl, fromJson,
         Source } from '@triplyetl/etl/generic'
import { iri, pairs } from '@triplyetl/etl/ratt'
import { qudt, rdf, unit } from '@triplyetl/etl/vocab'

const base = declarePrefix('https://example.com/')
const prefix = {
  graph: declarePrefix(base('id/graph/')),
  skolem: declarePrefix(base('.well-known/genid/')),
}

export default async function (): Promise&lt;Etl&gt; {
  const etl = new Etl({ defaultGraph: prefix.graph('instances') })
  etl.use(
    fromJson([{ id: '1', height: 15 }]),
    pairs(iri(prefix.skolem, 'id'),
      [qudt.unit, unit.CentiM],
      [rdf.value, 'height'],
    ),
    compareGraphs(Source.file('product-1.trig')),
  )
  return etl
}
</code></pre>
<h2 id="step-1-identify-representative-records">Step 1: Identify representative records</h2>
<p>Select a limited number of records from your data sources that together are representative for the full data source systems.</p>
<p>This often includes typical records where the expected data items are included, as well as atypical records that are 'outliers'.</p>
<p>There must be reasonable confidence that a TriplyETL pipeline that produces the correct results for these selected records is likely to produce correct results for all records.</p>
<h2 id="step-2-manually-create-linked-data">Step 2: Manually create linked data</h2>
<p>Create an RDF file for every representative record.  The file must contain the linked data that should be generated for that specific record.  It is probably best to use the TriG format for this, but all RDF formats are supported.</p>
<p>For our example, we create a file called <code>product-1.trig</code> with the following content:</p>
<pre><code class="language-turtle">prefix graph: &lt;https://example.com/id/graph/&gt;
prefix qudt: &lt;http://qudt.org/schema/qudt/&gt;
prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
prefix unit: &lt;http://qudt.org/vocab/unit/&gt;

graph:instances {
  []
    qudt:unit unit:CentiM;
    rdf:value 15.
}
</code></pre>
<h2 id="step-3-create-the-etl">Step 3: Create the ETL</h2>
<p>Write the TriplyETL configuration.  In our example we start with the prefix declarations:</p>
<pre><code class="language-ts">const base = declarePrefix('https://example.com/')
const prefix = {
  graph: declarePrefix(base('id/graph/')),
  skolem: declarePrefix(base('.well-known/genid/')),
}
</code></pre>
<p>We use the following extractor:</p>
<pre><code class="language-ts">fromJson([{ id: '1', height: 15 }]),
</code></pre>
<p>And we use the following assertions:</p>
<pre><code class="language-ts">pairs(iri(prefix.skolem, 'id'),
  [qudt.unit, unit.CentiM],
  [rdf.value, 'height'],
),
</code></pre>
<h2 id="step-4-perform-graph-comparison">Step 4. Perform graph comparison</h2>
<p>In our example, we only generate linked data for one record, so we can trivially compare the results for that one record with the manually created RDF that is stored in the local file:</p>
<pre><code class="language-ts">compareGraphs(Source.file('product-1.trig')),
</code></pre>
<p>In more complex pipleines you may need to determine the local file based on the data.  For example, check whether the value for key <code>id</code> in the record corresponds to a local file called <code>product-ID.trig</code>.</p>
<p>If the generated graph differs in any meaningful way from the RDF stored in the local file, and error is emitted and the TriplyETL pipeline is interrupted.</p>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../../../js/main.js"></script>
<script src="../../../search/main.js"></script>
<script src="../../../js/gitbook.min.js"></script>
<script src="../../../js/theme.min.js"></script>
</body>
</html>