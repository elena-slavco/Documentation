<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>5. Validate: Graph Comparison - Triply Documentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "5. Validate: Graph Comparison";
        var mkdocs_page_input_path = "triply-etl/validate/graph-comparison/index.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Triply Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">TriplyDB</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../triply-db-getting-started/">Getting started</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">TriplyETL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/">Getting started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cli/">Command Line Interface (CLI)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../changelog/">Changelog</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../maintenance/">Maintenance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Yasgui</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../yasgui/">Introduction</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Triply Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>5. Validate: Graph Comparison</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>Graph comparison is an approach for validating that the data produced by your TriplyETL pipeline is correct.</p>
<p>For a limited set of key records, the linked data that is generated by the TriplyETL pipeline is compared to graphs that were created by hand.  This comparison must follow certain rules that are laid out in the RDF standards.</p>
<h1 id="prerequisites">Prerequisites</h1>
<p>Graph comparison can be used when the following preconditions are met:</p>
<ol>
<li>You have identified a number of key records that are representative of your dataset.</li>
<li>For these identified key records, you have created RDF files that contain the linked data that should be generated by your TriplyETL pipeline.</li>
<li>You have added these RDF files to your TriplyETL configuration, e.g. by storing them in a special subdirectory next to your <code>*.ts</code> files.</li>
</ol>
<p>The function for comparing graphs can be imported from the generic TriplyETL library:</p>
<pre><code class="language-ts">import { compareGraphs } from '@triplyetl/etl/generic'
</code></pre>
<h1 id="a-complete-example">A complete example</h1>
<p>We use the following full TriplyETL script to explain the validation feature.  Do not be afraid by the length of the script; we will go through each part step-by-step.</p>
<pre><code class="language-ts">import { compareGraphs, declarePrefix, Etl, fromJson,
         Source } from '@triplyetl/etl/generic'
import { iri, pairs } from '@triplyetl/etl/ratt'
import { qudt, rdf, unit } from '@triplyetl/etl/vocab'

const base = declarePrefix('https://example.com/')
const prefix = {
  graph: declarePrefix(base('id/graph/')),
  skolem: declarePrefix(base('.well-known/genid/')),
}

export default async function (): Promise&lt;Etl&gt; {
  const etl = new Etl({ defaultGraph: prefix.graph('instances') })
  etl.use(
    fromJson([{ id: '1', height: 15 }]),
    pairs(iri(prefix.skolem, 'id'),
      [qudt.unit, unit.CentiM],
      [rdf.value, 'height'],
    ),
    compareGraphs(Source.file('product-1.trig')),
  )
  return etl
}
</code></pre>
<h2 id="step-1-identify-representative-records">Step 1: Identify representative records</h2>
<p>Select a limited number of records from your data sources that together are representative for the full data source systems.</p>
<p>This often includes typical records where the expected data items are included, as well as atypical records that are 'outliers'.</p>
<p>There must be reasonable confidence that a TriplyETL pipeline that produces the correct results for these selected records is likely to produce correct results for all records.</p>
<h2 id="step-2-manually-create-linked-data">Step 2: Manually create linked data</h2>
<p>Create an RDF file for every representative record.  The file must contain the linked data that should be generated for that specific record.  It is probably best to use the TriG format for this, but all RDF formats are supported.</p>
<p>For our example, we create a file called <code>product-1.trig</code> with the following content:</p>
<pre><code class="language-turtle">prefix graph: &lt;https://example.com/id/graph/&gt;
prefix qudt: &lt;http://qudt.org/schema/qudt/&gt;
prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
prefix unit: &lt;http://qudt.org/vocab/unit/&gt;

graph:instances {
  []
    qudt:unit unit:CentiM;
    rdf:value 15.
}
</code></pre>
<h2 id="step-3-create-the-etl">Step 3: Create the ETL</h2>
<p>Write the TriplyETL configuration.  In our example we start with the prefix declarations:</p>
<pre><code class="language-ts">const base = declarePrefix('https://example.com/')
const prefix = {
  graph: declarePrefix(base('id/graph/')),
  skolem: declarePrefix(base('.well-known/genid/')),
}
</code></pre>
<p>We use the following extractor:</p>
<pre><code class="language-ts">fromJson([{ id: '1', height: 15 }]),
</code></pre>
<p>And we use the following assertions:</p>
<pre><code class="language-ts">pairs(iri(prefix.skolem, 'id'),
  [qudt.unit, unit.CentiM],
  [rdf.value, 'height'],
),
</code></pre>
<h2 id="step-4-perform-graph-comparison">Step 4. Perform graph comparison</h2>
<p>In our example, we only generate linked data for one record, so we can trivially compare the results for that one record with the manually created RDF that is stored in the local file:</p>
<pre><code class="language-ts">compareGraphs(Source.file('product-1.trig')),
</code></pre>
<p>In more complex pipleines you may need to determine the local file based on the data.  For example, check whether the value for key <code>id</code> in the record corresponds to a local file called <code>product-ID.trig</code>.</p>
<p>If the generated graph differs in any meaningful way from the RDF stored in the local file, and error is emitted and the TriplyETL pipeline is interrupted.</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
